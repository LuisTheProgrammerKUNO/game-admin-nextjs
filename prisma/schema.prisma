// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum QuestionType {
  mul_choice
  fill_blank
  identification
}

model Module {
  module_id Int    @id @default(autoincrement())
  name      String @db.VarChar(100)

  // back-rel
  questions Question[] @relation("ModuleQuestions")

  @@map("modules")
}

model Question {
  question_id Int          @id @default(autoincrement())
  module_id   Int
  type        QuestionType
  text        String       @db.Text

  // FK -> modules.module_id
  module Module @relation("ModuleQuestions", fields: [module_id], references: [module_id], onDelete: Cascade, onUpdate: Cascade)

  // back-rel
  answers Answer[] @relation("QuestionAnswers")

  @@map("questions")
}

model Answer {
  answer_id   Int     @id @default(autoincrement())
  question_id Int
  text        String  @db.VarChar(255)
  is_correct  Boolean @default(false)

  // FK -> questions.question_id
  question Question @relation("QuestionAnswers", fields: [question_id], references: [question_id], onDelete: Cascade, onUpdate: Cascade)

  @@map("answers")
}

model User {
  id               Int       @id @default(autoincrement())
  username         String    @unique
  email            String    @unique
  passwordHash     String?
  displayName      String?
  gender           String?
  birthday         String?
  avatar           Bytes?
  avatarUrl        String?
  role             String?   // 'admin' or 'user' (optional)
  isActive         Boolean   @default(true)

  // If not null => user has requested deletion (admin can approve/cancel)
  requestDeletion  DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@map("user")
}
